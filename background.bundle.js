(()=>{var e=new WebSocket("ws://localhost:8080");function n(){chrome.windows.create({url:"index.html",type:"popup",width:400,height:800},(function(e){chrome.tabs.onUpdated.addListener((function n(t,o,r){t===e.tabs[0].id&&"complete"===o.status&&chrome.tabs.onUpdated.removeListener(n)}))}))}self.addEventListener("install",(function(e){console.log("Service worker installed")})),self.addEventListener("activate",(function(e){console.log("Service worker activated")})),self.addEventListener("fetch",(function(e){console.log("Service worker fetching")})),chrome.runtime.onInstalled.addListener((function(){n()})),chrome.runtime.onStartup.addListener((function(){chrome.windows.getAll({populate:!0},(function(e){for(var t=!1,o=0;o<e.length;o++)if(e[o].tabs&&e[o].tabs[0].url.includes("index.html")){t=!0;break}t||n()}))})),chrome.runtime.onMessage.addListener((function(e,n,t){if("openNewTab"===e.action){console.log("Received openNewTab request");var o=e.url.toString();return console.log("Sending URL:",o),fetch("http://localhost:3000/url",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({url:o})}).then((function(e){return e.json()})).then((function(e){console.log("Response from server:",e)})).catch((function(e){console.error("Error:",e)})),!0}})),chrome.runtime.onMessage.addListener((function(e,n,t){if("userInput"===e.action){var o=e.userInput.toString();return console.log("Received userInput:",o),fetch("http://localhost:3000/user_command",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_command:o})}).then((function(e){return e.json()})).then((function(e){console.log("Response from server:",e)})).catch((function(e){console.error("Error:",e)})),!0}})),e.onmessage=function(e){var n;"contentUpdated"===e.data&&(n="",fetch("http://localhost:3000/content",{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){n=e})).catch((function(e){console.error("Error:",e)})),console.log(n),chrome.runtime.sendMessage({action:"contentUpdated",content:n}))}})();